<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" /><title>加密的Post，密码:abc</title><link rel="shortcut icon" type="image/x-icon" href="/logo.png" /><link rel="stylesheet" href="/assets/css/left.css" />
  

  <script>
    setTimeout(() => {
      const link = document.createElement('link');
      link.rel = 'stylesheet';
      link.href = '//no-style.kr7y.workers.dev/zeta.css?2ea96485f2';
      link.type = 'text/css';
      document.head.appendChild(link);
    }, 500);
  </script>
</head><body a="auto">
    <main class="page-content" aria-label="Content"><header><div class="sidebar">

<div class="sidecontent">
<div class="avatar-title">
  <a href="/"  ><img src="/assets/image/avatar.png"  class="avatar"/> </a>

  <a href="/" class="nav-title"  > jekyll-zeta! </a>
</div>



<nav>
  <ul class="navul">
      <li class="navli curNav">

      <a href="/" class="nav">Posts</a></li>
      <li class="navli">

      <a href="/archive.html" class="nav">Achive</a></li>
      <li class="navli">

      <a href="/tags.html" class="nav">Tags</a></li>
      <li class="navli">

      <a href="/about.html" class="nav">About</a></li></ul>
</nav>


</div>


</div></header>
<section class="rightsidecontent">
<div class="w">
    
    <h2>加密的Post，密码:abc</h2><time datetime="2024-05-16 18:55:32 +0000">2024/05/16 Thu</time> &nbsp; &nbsp;<a href="/tags/blog.html" class="tag"><text><nobr>#blog</nobr></text>&nbsp;</a><a href="/tags/jekyll-zeta.html" class="tag"><text><nobr>#jekyll-zeta</nobr></text>&nbsp;</a><article><style>
.errPsw{
    animation: shake 0.4s cubic-bezier(0.25, 1.5, 0.5, 1);
    border:solid 2px #f0ada0;    
    border-radius: 4px;
}
    @keyframes shake {
        0% {
        transform: translateX(0);
    }
    20% {
        transform: translateX(-15px);
    }
    40% {
        transform: translateX(10px);
    }
    60% {
        transform: translateX(-7px);
    }
    80% {
        transform: translateX(5px);
    }
    100% {
        transform: translateX(0);
    }
    }
</style>


<div id="encrypted">
    <h3> Content is Encryped :) </h3>
   
    <input style="width:100%; " type="password" id="passwordinput" placeholder="输入密码"></input>
    <p>
        <input type="button" value= "Decrypt" id="DecryptBtn"/>
        <input type="button" value= "Clear password cache" id="ClearBtn1"/>
    
    </div>
    
    <div id="decrypted"  style = "display:none">
        <p>
        <div>
           
            <input type="button" value= "Encrypt" id="EncryptBtn"/>

            <input type="button" value= "Clear password cache" id="ClearBtn2"/>
           
        </div>
        <div id = 'decryptContent'>
        </div>
    </div>
    <script>
        var exports = exports || {} 
    </script>
    <script src="//cdn.jsdelivr.net/gh/vitock/jsdelivr@0.1.2/js/base64js.js"></script>
    <script>
        
function uint8ArrayToHex(uint8Array) {
  return Array.from(uint8Array)
    .map(byte => byte.toString(16).padStart(2, '0'))  // 转换每个字节为2位16进制
    .join('');  // 连接成字符串
}
    const contentEnc = 'I6EIgiOgDQwYSRpscXDX1hlcM3klXZ5DP1pvzmDyfznCUCoBPEPnu+FVphc44++bIXZXhcCO/aokA9whqggCRhbZmTPUtPM3VfDxDFyGswa/ln5py1Z6UDtFZPKod5EhCeDN7NXHexFlC8mPiPP1emXdZ2ucGo5jRrfY97Jy7GgYeZUaQi5njEeQA6b3mfZ6dl1qMCGG5voOHwB9E5kC5b+GLGUvZt/ha5qrqiPTjBrS0UlRpYId6C83AtnTtnSDwSBoGjHLfMDZToH3mki9TAF99FoavDGUgjIXYxqdUiBZQI0NKYyhkNTrrGIFVd1TyD3SYBXUMzPkAK7LLslxV7zP8aT0Fk4lvUcr8doQh2t4oM7gmw/JWZRu01FfkraHzl0mY1XjDRGYhgFftnd4OUmc1Jfc4loFAeuPm+a7gIsl2FFRCzzFvYn9M4lDmgSSaPABruieMxYiKXRmI7zhwM7ESR1Fa4ZK8NWkJeBrc2rf36owLqrm0hfnYjVYq5mUwmeJRBhcrYPOx6G6N68u5VrqR8Cr+h2nGPOdRmYNhDS6z301F9baavt/k8AUDxsXJcNgFO12BO6kpa7HwfR3csPr/sGIZOwzeecYbX13xfXzrdKI3wiE9SBEWdPAl+uiX/SUv8PkBycME7BMdw4OtCGfazBqELEZYq4pIKrHNwrtQG2kbS1rufI4AkucoDC/qlZjY3pSmhhaV+UFAbXWv6SUVUB2tS9/nWCxCVCDriq4Tn5ZHYlyyHd4UUPq0PkuJMX+Wl50VwA7qQd/4/gV9KQW0671KtjweYo06Lr94jRXQ8b7zJwTchMaWA4wZY0Csp0P8NZCg7MKMgXa2BfGeOCD+9PYPeeUL7xbN6RgmYSsVGFqLxqXGN/TRAm55cszlgoMkOlDMrvvEaKS08WDSvZFcYYPDkvqQqtO/PN122mjpLnDNu3lS3bALPx5bbk6UzEJ7PdB2NPSPWehETg2JUM/LvggCiLB3T75THvgQZQc5W75Vi4evgFCp7Dfz1PB99cckfhOcz+8szuRE4O4pr3ASC+fuKKZTjD28OW+26bcz7I7IwG1UJjdodBTZnqy2j6Td4q+sFTGVCVBboLL1mHx9c8Dw1WbdVVX07Jnrk1eDWihLHjB/qavnpj+bF5Oiw4vv1O8k7qmVuAil16aK0Av4UePIEU0NiP/8rYmGgt4eEumDTBdIGCRMgDvQu3ZwkXrQ+893Ojd9TirIiAPEObjYGmNU5JxWReMIepmFlXnH+piOskpJbUps3cm/bdIHcBngbIC196pBSPYztvbk4jPyA+JGqoO2qQV+qs5PUvi7QTPV33y3+qOb/DEJKLE75ZVgdjvfLsZXUm7lkBeE6nb56ZA7niy4WwdPy+SIUDpia53K0ycd8jVyNYw2s1SaguE97ijkHgVFy99TQrD/SKs8A7Y9i+hSLC197Ib+Hgk0OcWSGp4NYtF1zDYYUjHzUSSQCEsxKCxhaxFc5a1iiNwo9vGiV8zrQZtpU/xfvXz4poc12Qizp80mx6CCAEqN1DrKLOn47MyEqGVwd1pskEDUhY98ozkp6d8+t0rYtL9WeRGzKtSQeig9OkcnXbQ1c3jaFk0J1nNEBuArME4gW8AgHZafFGHkGoN4p4vQsT/1F/gaQqm/WQGeE2S05EwIe40YdOEXrxSAAp7nVQENa5P4diqjKL9c4XXpUsyXHsYsJVuZihY30U1cic3Y55dVI2kNzPZR8bAGdfwu2K3QI5FxqzAj32iRHosvlOpxUeJaE6u7NvhajWNqJKvMabCpTnQ2NHvbDjGf7bcCR5aswLJ7BF2m5OIRY05h9EhNzQt2TosOS08UJPm7512k4mpUoOnB677NEyx8X56psqiQzkL3J6bcqwzXZJsOFMRLjwacyiwV9oJORqNwzqiL7ZLUPa3M8Tym7qy75qNBzPm8BztMhNguuiW4N+t/SVkmiMMj6ApL1UL7MpsaVJjvESBZAIolKjXf8T1MBh21ie+NdbRhF73uk03uC0Py07dySUIHbG9zhJTWRDME9iWdM1e8SLcMoavt3iSRewXQ4oAYG9UEwolkIMuSEvTKhkOZIO67kr0l/guW8kOzElMyEFifTRjghGpzakQA/apMzUG8ELhi+wMn/4sGSLD1Ra76PJPFkqai4S6oU7JOb0oGM+cGDtHItep1ALELehse1jhiH9O6J8gXW/+VEXvTT2k7lW6E/vdkJVl1f7JDXt4ZSj4jzYbwk9QHMkb7nOFGGxOl+4qyw97jzJ4Vs7JVFTf4nUB+8fwQFmQmmmbVt9n9oNI47pZWZFGDa9HLwIHSXJKEJf3IJjCto9nBAGCHF42ynudw860NpaY5M96j3+dxE0JJ1KHPD5R6eFA1X3GA9BibeUenihwIfNTtrJ8rmIad5hznQbn6xsnWLi4Rl2fVjbq6Qj5TBW4CbRXX/qDnaf3fbEFp/+tI7TNXtQjpAy3xU0p9FKXqBx5XLBIJ4fr5vC0zWTJu4SKG9z383z7B27rQ6HZDshCx8WbOzuXNCuKbMu8aJSAx3xagsEflgdNbZcfvG/CC/o3gjRiZNR4rA==';
    
        !function(){

            const substl = crypto.subtle
            const preFix = 'cff9f7f298d96aff127148ebe5ef43450';
            const encid = preFix
            const encryptedContent = contentEnc;
            const base64str = encryptedContent.substring(3)
            const bfMsg = base64js.decode(base64str)
            const bfIv = bfMsg.subarray(0,12)
            const bfCipher = bfMsg.subarray(12)
            
            async function genKey(psw){
                var keyRaw = new TextEncoder().encode(psw)
                var key = await substl.importKey('raw',keyRaw,'PBKDF2',false,["deriveBits"])
                const salt = 'this is a salt string 20221019'
                let pbkdf2  = {
                    name:"PBKDF2",hash: "SHA-256",iterations: 12345,salt: new TextEncoder().encode(salt)
                }
                return  await substl.deriveBits(pbkdf2,key,256);
            }

        async function decryptRaw(bf,key,outV){
            if(bf.length < 8){
                if(outV){
                     outV.count = bf.length
                }
                throw 'err'
            }
            let count = 0;
            for (let i  = 0; i  < 4; i ++) {
                count |= ((bf[i] ^ bf[i + 4] ^ i) << ((3 - i) * 8))
            }

            if(outV){
                outV.count = count
            }
            if (bf.length < count) {
                return
            }

            let bfIv = bf.slice(4,20)
            let bfCipher = bf.slice(20,count )
   
            var aeskey = {
                name:"AES-CTR",
            }
            var keyObj = await substl.importKey('raw',key,aeskey,false,['decrypt'])
            var aesDec= {name: "AES-CTR",counter:bfIv,length:64};
            try{
                let bfDec  = await substl.decrypt(aesDec,keyObj,bfCipher)
                return  new  Uint8Array(bfDec)
            }catch (error) {
                throw error
            }
             
        }
 
        async function decryptBase64Msg(msg64,key){
            const base64str = msg64;
            const bfMsg = base64js.decode(base64str)
            return await decryptRaw(bfMsg,key)

        }
        async function checkKey(key){
            const keyData  = "/Mr6zPzL+PvgSPkcdJV05vnWgIkq8TOZoUawx2+YI+V6+GSDYwjhY6ts+jLzJEBDPrVNDA==";
             
            const arrTest = 'zqiFX7m2yl1aBh8lPZ12tSVPVbZH8rm/2JNfTA8dtC7DamTvzKf6g1wJ7Z5Wym73rqoS5r6rFr6quLOWoz38.GboBxRm7A654XsCrOCX231nQ/1VDeCqOdXOo6qFlUfJkayrooc1CbOFd3+HrZ7ZeNavKqvHJPSogpW5bEfjF+sfm5t8mBJJl6m2RDz7hrljdkk2BHyrHRNHScA6Q4BtU6IRp5rEDE3s='.split('.');
            const testData = arrTest[0];
            const testDataEnc = arrTest[1];
            const bfTestData = base64js.decode(testDataEnc)


            const bfKeyData = base64js.decode(keyData)
            let keyBf = null
            let C  = 0;
            let sum = 0;
            while (C ++ < 400 ) {
                if (sum >= bfKeyData.length ) {
                    break
                }
                let bfSub = bfKeyData.slice(sum)
                
                try {
                    let outV = {count:0}
                    let d = await decryptRaw(bfSub,key,outV)

                    sum += outV.count
                    if (d) {
                        let dec = await decryptRaw(bfTestData,d)
                        let s =  new TextDecoder().decode(dec) 
                        if(s == testData){
                            keyBf = d;
                            break;
                        }
                    }else{
                       
                    }
                    
                    
                } catch (error) {
                     
                }
            }
             
            return keyBf
        }
 
        async function decrypt (key0,isCached){
            // const key = Uint8Array([...]); // 32 bytes key
            var key  = ''
            if(isCached){
                key = readKey()
            }
            else{
                var keyS = preFix + key0 +  preFix
                key = await genKey(keyS)
            }
            if (key.length == 0) {
                return
            }
            try {
                let keyBf = await checkKey(key)
                if(!keyBf){
                    throw 'error psw'
                }
                var bfDec  = await decryptBase64Msg(contentEnc,keyBf)
                var plain = new TextDecoder().decode(bfDec);
                setKey(key)
                document.getElementById("encrypted").style.display = 'none'
                // / show decrypted 
    
                document.getElementById("decrypted").style.display = 'block'
                document.getElementById("decryptContent").innerHTML = plain
    
                setTimeout(function(){
                    var loadevent = document.createEvent("Event")
                    loadevent.initEvent("load", true, true)
    
                    var DOMContentLoaded_event = document.createEvent("Event")
                    DOMContentLoaded_event.initEvent("DOMContentLoaded", true, true)
    
                    window.dispatchEvent(loadevent)
                    window.dispatchEvent(DOMContentLoaded_event)
    
                }, 500);
            } catch (error) {
                console.log(error)
                // alert("wrong password.")
                document.getElementById('passwordinput').classList.add('errPsw');
                setTimeout(() => {
                    document.getElementById('passwordinput').classList.remove('errPsw')
                }, 500);
            }
        }
        
        document.getElementById("DecryptBtn").onclick = function(){
            var key = document.getElementById("passwordinput").value
            decrypt(key);        
        }
    
        document.getElementById("EncryptBtn").onclick = function(){
            /// hide input
            document.getElementById("encrypted").style.display = 'block'
            // / show decrypted 
            document.getElementById("decrypted").style.display = "none"
    
            clearKey()
        }

        document.getElementById("EncryptBtn").onclick = function(){
            /// hide input
            document.getElementById("encrypted").style.display = 'block'
            // / show decrypted 
            document.getElementById("decrypted").style.display = "none"
    
            clearKey()
        }

        document.getElementById("ClearBtn1").onclick = function(){
            localStorage.clear();
            document.getElementById('passwordinput').value = ''
        }
        document.getElementById("ClearBtn2").onclick = function(){
            localStorage.clear();
        }

        

        
    
        
            function readKey(){
                var key = encid;
                var v = localStorage.getItem(key)
                if (v) {
                    return base64js.decode(v)
                }else{
                    return null
                }
            }
            function setKey(value){
                var key = encid
                var arr = new Uint8Array(value)
                var b64 = base64js.encode(arr)
                return localStorage.setItem(key,b64)
            }
            function clearKey() {
                var key = encid
                localStorage.removeItem(key)
            }
            var cachekey = readKey()
            if(cachekey){
                decrypt(cachekey,true)
            }

        
        
        
 
    }()
    
    
    </script>
    </article>
<footer class="footer">
      <p> Powered by <a href="https://jekyllrb.com/">Jekyll</a> & <a href="https://github.com/vitock/jekyll-zeta">Jekyll-zeta</a>
     </p>
    </footer></div>
</section></main></body>
</html>
